<div class="context-container" [class.context-selected]="selected">
  <div class="context-header">
    <ng-container *ngIf="parent">
      <h3 class="context-title">
        <div class="md-form md-form-sm input-group">
          <span *ngIf="!edits.contextName">{{context.contextName}}</span>
          <input type="text" *ngIf="edits.contextName" [(ngModel)]="context.contextName" class="form-control form-control-sm">
          <button type="button" class="btn btn-sm btn-primary" (click)="edits.contextName = !edits.contextName">
            <span *ngIf="edits.contextName">Ok</span>
            <span *ngIf="!edits.contextName">Edit</span>
          </button>
          <button type="button" class="btn btn-sm btn-danger" style="position: absolute; right: 0;" (click)="deleteContext()">Delete</button>
        </div>
      </h3>
      <div class="context-state">
        <input type="text" [(ngModel)]="context.state" *ngIf="edits.state">
        <lib-expr-parser *ngIf="!edits.state" [expression]="context.state" [context]="_this" [parent]="undefined"></lib-expr-parser>
        <button type="button" class="btn btn-sm btn-primary" (click)="edits.state = !edits.state">
          <span *ngIf="edits.state">Ok</span>
          <span *ngIf="!edits.state">Edit</span>
        </button>
        <button type="button" class="btn btn-sm btn-info" style="float: right;" (click)="hidden = !hidden">Show/Hide</button>
      </div>
    </ng-container>
  </div>
  <div class="context-actions" *ngIf="!hidden">
    <table>
      <tr *ngFor="let a of context.actions">
        <td (click)="changeAction(a)">{{a.channel}}</td>
        <td>
          <span *ngIf="a.edit">
            <input type="text" [(ngModel)]="a.affectation.value">
          </span>
          <span *ngIf="!a.edit">
            <lib-expr-parser [expression]="a.affectation.value" [context]="_this" [parent]="undefined"></lib-expr-parser>
          </span>
        </td>
        <td>
          <button type="button" class="btn btn-sm btn-primary" (click)="a.edit = !a.edit">
            <span *ngIf="a.edit">Ok</span>
            <span *ngIf="!a.edit">Edit</span>
          </button>
          <button type="button" class="btn btn-sm btn-danger" (click)="deleteAction(a)">Delete</button>
        </td>
      </tr>
      <tr>
        <td colspan="3">
          <button type="button" class="btn btn-sm btn-success w-100 m-0" (click)="newAction()">New action</button>
        </td>
      </tr>
    </table>
  </div>
  <div class="context-subcontexts" *ngIf="!hidden">
    <div class="context-before">
      <h3>Before</h3>
    </div>
    <div class="context-during">
      <h3>During</h3>
      <div class="context-contexts" [dragula]='"bag"' [dragulaModel]='context.allen.During' style="min-height: 20px">
        <lib-context
            *ngFor="let c of context.allen.During"
            [context]="c"
            [parent]="_this"
            [wrapper]="wrapper"
            class="context-child"></lib-context>
        <button type="button" class="btn btn-sm btn-success w-100 m-0 mt-2" (click)="newDuringContext()">New context</button>
      </div>
    </div>
    <div class="context-after">
      <h3>After</h3>
    </div>
  </div>
</div>
